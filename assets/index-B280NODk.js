import{_ as E}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BWN6FZjJ.js";import{f as d,w as l,e as g,A as u,ag as h,o as y,a as s,H as t,g as m,U as e}from"./app-O6veFoRw.js";import"./YunComment.vue_vue_type_style_index_0_lang-BdmCVZ97.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-6OskRlK9.js";import"./post-CxZOEfth.js";const c="/assets/snipaste20170908_165246-CMrq_ocG.png",$={__name:"index",setup(F,{expose:r}){const n=JSON.parse('{"title":"使用相对路径发布vue-cli项目的坑","description":"","frontmatter":{"title":"使用相对路径发布vue-cli项目的坑","date":"2017-09-08 16:21:07","categories":"学习笔记","tags":["vue","vue-cli","webpack"]},"headers":[],"relativePath":"pages/posts/2017-09-08-pitfalls_of_publishing_vue_cli_projects_using_relative_paths/index.md","path":"/home/runner/work/blog/blog/pages/posts/2017-09-08-pitfalls_of_publishing_vue_cli_projects_using_relative_paths/index.md","lastUpdated":1733198069000}'),k=u(),p=n.frontmatter||{};return k.meta.frontmatter=Object.assign(k.meta.frontmatter||{},n.frontmatter||{}),h("pageData",n),h("valaxy:frontmatter",p),globalThis.$frontmatter=p,r({frontmatter:{title:"使用相对路径发布vue-cli项目的坑",date:"2017-09-08 16:21:07",categories:"学习笔记",tags:["vue","vue-cli","webpack"]}}),(a,i)=>{const o=E;return y(),d(o,{frontmatter:g(p)},{"main-content-md":l(()=>[i[0]||(i[0]=s("p",null,"使用vue-cli可以快速创建一个webpack项目脚手架，有相当多的项目都使用了相似的配置。 它们对发布环境的配置差不多是这样的：",-1)),i[1]||(i[1]=s("div",{class:"language-javascript vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"module"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"exports"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  build: {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    env: "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"require"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'./prod.env'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    index: path."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"resolve"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(__dirname, "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'../dist/index.html'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    assetsRoot: path."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"resolve"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(__dirname, "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'../dist'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    assetsSubDirectory: "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'assets'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    assetsPublicPath: "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'/'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    productionSourceMap: "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // Gzip off by default as many popular static hosts such as")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // Surge or Netlify already gzip all static assets for you.")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // Before setting to `true`, make sure to:")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // npm install --save-dev compression-webpack-plugin")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    productionGzip: "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    productionGzipExtensions: ["),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'js'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'css'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  },")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  ...")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"collapse"})],-1)),m(" more "),i[2]||(i[2]=s("p",null,[t("这种配置只能通过根路径访问，比如"),s("code",null,"http://project.example.com/"),t("。")],-1)),i[3]||(i[3]=s("p",null,[t("如果这个项目发布的内网地址是"),s("code",null,"http://192.168.1.101/project/"),t("，那么它实际上是无法被直接访问的，所有js、css等资源的引用地址全部会出错。")],-1)),i[4]||(i[4]=s("p",null,"从调试器中可以看到这些URL全都是写死成从根路径开始的。",-1)),i[5]||(i[5]=s("p",null,[t("而如果想要以"),s("code",null,"http://www.example.com/project/"),t("来访问项目，就只有将"),s("code",null,"assetsPublicPath"),t("修改成"),s("code",null,"'/project/''"),t("并重新编译打包发布。")],-1)),i[6]||(i[6]=s("p",null,"显然这种做法相当不灵活。",-1)),i[7]||(i[7]=s("p",null,"理想的做法是将项目以相对路径形式发布，无论它位于什么层级，都可以以相对路径的方式请求到引用的资源。",-1)),i[8]||(i[8]=s("p",null,"很多教程都是这么教的：",-1)),i[9]||(i[9]=s("blockquote",null,[s("p",null,"只要把根目录改为相对目录就好了")],-1)),i[10]||(i[10]=s("div",{class:"language-javascript vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"assetsPublicPath"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'./'")])])]),s("button",{class:"collapse"})],-1)),i[11]||(i[11]=s("p",null,"如果只是拿脚手架做点练习，这样做也许可以。",-1)),i[12]||(i[12]=s("p",null,"但只要你的项目有CSS引用了图片或者字体，并且它们会被归类到各自的目录，光是修改assetsPublicPath是不够的，会遇到这样的问题：",-1)),i[13]||(i[13]=s("figure",null,[s("img",{src:c,alt:"",loading:"lazy",decoding:"async"})],-1)),i[14]||(i[14]=s("p",null,"如果项目中用到了Bootstrap或者FontAwesome之类的工具，那这个坑是必然绕不过去的。",-1)),i[15]||(i[15]=s("p",null,"完美的解决方法是在cssLoaders中为CSS单独配置publicPath：",-1)),i[16]||(i[16]=s("div",{class:"language-javascript vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (options.extract) {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ExtractTextPlugin."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"extract"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"({")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        use: sourceLoader,")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        fallback: "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'vue-style-loader'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        publicPath: "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'../../'")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      })")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")])])]),s("button",{class:"collapse"})],-1)),i[17]||(i[17]=s("p",null,"我的输出目录是dist > index.html + assets > css + fonts + img + js，因此publicPath需要向上返回两级，可根据实际项目配置修改它的值。",-1)),i[18]||(i[18]=s("p",null,"步骤总结：",-1)),i[19]||(i[19]=s("ol",null,[s("li",null,[s("p",null,[t("在"),s("code",null,"config/index.js"),t("中，将"),s("code",null,"assetsPublicPath"),t("修改为"),s("code",null,"./")])]),s("li",null,[s("p",null,[t("在"),s("code",null,"build/utils.js"),t("中，找到"),s("code",null,"ExtractTextPlugin.extract"),t("，添加配置项"),s("code",null,"publicPath: '../../'")])])],-1))]),"main-header":l(()=>[e(a.$slots,"main-header")]),"main-header-after":l(()=>[e(a.$slots,"main-header-after")]),"main-nav":l(()=>[e(a.$slots,"main-nav")]),"main-content":l(()=>[e(a.$slots,"main-content")]),"main-content-after":l(()=>[e(a.$slots,"main-content-after")]),"main-nav-before":l(()=>[e(a.$slots,"main-nav-before")]),"main-nav-after":l(()=>[e(a.$slots,"main-nav-after")]),comment:l(()=>[e(a.$slots,"comment")]),footer:l(()=>[e(a.$slots,"footer")]),aside:l(()=>[e(a.$slots,"aside")]),"aside-custom":l(()=>[e(a.$slots,"aside-custom")]),default:l(()=>[e(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{$ as default};
