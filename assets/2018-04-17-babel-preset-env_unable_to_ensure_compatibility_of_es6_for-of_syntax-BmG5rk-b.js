import{_ as m}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BWN6FZjJ.js";import{f as d,w as a,e as b,A as f,ag as p,o as v,a as e,H as l,U as t}from"./app-O6veFoRw.js";import"./YunComment.vue_vue_type_style_index_0_lang-BdmCVZ97.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-6OskRlK9.js";import"./post-CxZOEfth.js";const w={__name:"2018-04-17-babel-preset-env_unable_to_ensure_compatibility_of_es6_for-of_syntax",setup(g,{expose:u}){const s=JSON.parse('{"title":"babel-preset-env无法确保ES6的for..of语法兼容性","description":"","frontmatter":{"title":"babel-preset-env无法确保ES6的for..of语法兼容性","date":"2018-04-17 16:42:35","categories":"学习笔记","tags":["babel","webpack"]},"headers":[],"relativePath":"pages/posts/2018-04-17-babel-preset-env_unable_to_ensure_compatibility_of_es6_for-of_syntax.md","path":"/home/runner/work/blog/blog/pages/posts/2018-04-17-babel-preset-env_unable_to_ensure_compatibility_of_es6_for-of_syntax.md","lastUpdated":1733198069000}'),r=f(),o=s.frontmatter||{};return r.meta.frontmatter=Object.assign(r.meta.frontmatter||{},s.frontmatter||{}),p("pageData",s),p("valaxy:frontmatter",o),globalThis.$frontmatter=o,u({frontmatter:{title:"babel-preset-env无法确保ES6的for..of语法兼容性",date:"2018-04-17 16:42:35",categories:"学习笔记",tags:["babel","webpack"]}}),(n,i)=>{const c=m;return v(),d(c,{frontmatter:b(o)},{"main-content-md":a(()=>i[0]||(i[0]=[e("p",null,[e("code",null,"babel-preset-env"),l("是现在最主流的babel解决方案，但是前阵子踩到了一个坑。 部分机型在执行到ES6的"),e("code",null,"for of"),l("语句时就会报错。")],-1),e("p",null,"原因有两个。",-1),e("p",null,[l("一是"),e("code",null,"babel-preset-env"),l("默认只转换语法(syntax)，而不会转换全局对象("),e("code",null,"Iterator"),l("、"),e("code",null,"Generator"),l("、"),e("code",null,"Set"),l("、"),e("code",null,"Maps"),l("、"),e("code",null,"Proxy"),l("、"),e("code",null,"Reflect"),l("、"),e("code",null,"Symbol"),l("、"),e("code",null,"Promise"),l("等)和全局对象上的新增方法（"),e("code",null,"Object.assign"),l("等）。")],-1),e("p",null,[l("二是"),e("code",null,"for of"),l("会被babel编译，编译之后其中会出现Symbol关键字。")],-1),e("p",null,[l("所以表面上看"),e("code",null,"for of"),l("似乎可以使用，但实际上涉及到了新全局对象，从而导致不支持"),e("code",null,"Symbol"),l("的浏览器报错。")],-1),e("p",null,[l("因此，"),e("code",null,"babel-preset-env"),l("并不像宣传("),e("code",null,"你需要的唯一Babel插件"),l(")描述的那样简单，它仍旧离不开那个笨重但好用的"),e("code",null,"babel-polyfill"),l("。")],-1),e("p",null,[l("最终的解决方案是在"),e("code",null,".babelrc"),l("中的"),e("code",null,"env"),l("下添加"),e("code",null,"useBuiltIns"),l("属性, 值为"),e("code",null,"entry"),l(":")],-1),e("div",{class:"language- vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,'"presets": [')]),l(`
`),e("span",{class:"line"},[e("span",null,'    ["env", {')]),l(`
`),e("span",{class:"line"},[e("span",null,'      "modules": false,')]),l(`
`),e("span",{class:"line"},[e("span",null,'      "useBuiltIns": "entry"')]),l(`
`),e("span",{class:"line"},[e("span",null,"    }]")]),l(`
`),e("span",{class:"line"},[e("span",null,"  ],")])])]),e("button",{class:"collapse"})],-1),e("p",null,"并在项目的主入口顶部添加:",-1),e("div",{class:"language- vp-adaptive-theme"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"}),e("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[e("code",{"v-pre":""},[e("span",{class:"line"},[e("span",null,"import 'babel-polyfill'")])])]),e("button",{class:"collapse"})],-1),e("p",null,"这样env会自动精简没有使用到的polyfill，比单纯直接引入polyfill要小一些。",-1),e("p",null,[e("code",null,"useBuiltIns"),l("还可以设置为"),e("code",null,"usage"),l("，也就是在未兼容的环境使用新对象或方法时在当前脚本顶部自动添加polyfill。")],-1)])),"main-header":a(()=>[t(n.$slots,"main-header")]),"main-header-after":a(()=>[t(n.$slots,"main-header-after")]),"main-nav":a(()=>[t(n.$slots,"main-nav")]),"main-content":a(()=>[t(n.$slots,"main-content")]),"main-content-after":a(()=>[t(n.$slots,"main-content-after")]),"main-nav-before":a(()=>[t(n.$slots,"main-nav-before")]),"main-nav-after":a(()=>[t(n.$slots,"main-nav-after")]),comment:a(()=>[t(n.$slots,"comment")]),footer:a(()=>[t(n.$slots,"footer")]),aside:a(()=>[t(n.$slots,"aside")]),"aside-custom":a(()=>[t(n.$slots,"aside-custom")]),default:a(()=>[t(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{w as default};
