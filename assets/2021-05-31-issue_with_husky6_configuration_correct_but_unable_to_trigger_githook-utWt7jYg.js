import{_ as u}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BWN6FZjJ.js";import{f as d,w as t,e as c,A as g,ag as r,o as m,a as s,H as i,U as e}from"./app-O6veFoRw.js";import"./YunComment.vue_vue_type_style_index_0_lang-BdmCVZ97.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-6OskRlK9.js";import"./post-CxZOEfth.js";const $={__name:"2021-05-31-issue_with_husky6_configuration_correct_but_unable_to_trigger_githook",setup(y,{expose:k}){const l=JSON.parse('{"title":"Husky6配置正确但无法触发githook的问题","description":"","frontmatter":{"title":"Husky6配置正确但无法触发githook的问题","categories":["学习笔记"],"tags":["husky","lint-staged","eslint"],"date":"2021-05-31 16:56:24"},"headers":[],"relativePath":"pages/posts/2021-05-31-issue_with_husky6_configuration_correct_but_unable_to_trigger_githook.md","path":"/home/runner/work/blog/blog/pages/posts/2021-05-31-issue_with_husky6_configuration_correct_but_unable_to_trigger_githook.md","lastUpdated":1733198069000}'),h=g(),n=l.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},l.frontmatter||{}),r("pageData",l),r("valaxy:frontmatter",n),globalThis.$frontmatter=n,k({frontmatter:{title:"Husky6配置正确但无法触发githook的问题",categories:["学习笔记"],tags:["husky","lint-staged","eslint"],date:"2021-05-31 16:56:24"}}),(a,o)=>{const p=u;return m(),d(p,{frontmatter:c(n)},{"main-content-md":t(()=>o[0]||(o[0]=[s("p",null,"项目中之前一直使用husky进行代码质量控制，主要包含两个步骤：",-1),s("ul",null,[s("li",null,"代码提交前，先执行eslint校验，不通过则不允许提交。"),s("li",null,"commit记录需要符合规范，用于自动生成changelog。")],-1),s("p",null,"Husky6的配置步骤如下：",-1),s("h4",{id:"安装husky-lint-staged和commitlint的安装略",tabindex:"-1"},[i("安装husky(lint-staged和commitlint的安装略) "),s("a",{class:"header-anchor",href:"#安装husky-lint-staged和commitlint的安装略","aria-label":'Permalink to "安装husky(lint-staged和commitlint的安装略)"'},"​")],-1),s("p",null,"确保package.json的依赖包含：",-1),s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,'"husky": "^6.0.0",')])])]),s("button",{class:"collapse"})],-1),s("h4",{id:"执行husky安装命令",tabindex:"-1"},[i("执行husky安装命令 "),s("a",{class:"header-anchor",href:"#执行husky安装命令","aria-label":'Permalink to "执行husky安装命令"'},"​")],-1),s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"husky install")])])]),s("button",{class:"collapse"})],-1),s("p",null,[i("在项目目录下会出现一个"),s("code",null,".husky"),i("文件夹，包含一个"),s("code",null,".gitignore"),i("文件和一个"),s("code",null,"_"),i("目录，不要改动它们，是存放husky脚本的。")],-1),s("h4",{id:"添加hook动作",tabindex:"-1"},[i("添加hook动作 "),s("a",{class:"header-anchor",href:"#添加hook动作","aria-label":'Permalink to "添加hook动作"'},"​")],-1),s("p",null,[i("根据"),s("a",{href:"https://typicode.github.io/husky/#/?id=create-a-hook",target:"_blank",rel:"noreferrer"},"教程"),i("添加命令，或者在"),s("code",null,".husky"),i("目录直接创建以下这两个文件：")],-1),s("p",null,"commit-msg",-1),s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/sh")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"."),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "$('),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dirname"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"$0"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'")/_/husky.sh"')]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"npx"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --no-install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," commitlint"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," --edit"),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," $1")])])]),s("button",{class:"collapse"})],-1),s("p",null,"用于commit内容校验",-1),s("p",null,"pre-commit",-1),s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"#!/bin/sh")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"."),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "$('),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dirname"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"$0"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'")/_/husky.sh"')]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"npx"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," lint-staged")])])]),s("button",{class:"collapse"})],-1),s("p",null,"用于代码eslint校验",-1),s("p",null,"注意文件名不可自定义，必须对应githook的阶段。",-1),s("p",null,"如果是初次配置，到这一步就已经可以正常运行了。",-1),s("h4",{id:"将husky安装命令配置为自动执行",tabindex:"-1"},[i("将husky安装命令配置为自动执行 "),s("a",{class:"header-anchor",href:"#将husky安装命令配置为自动执行","aria-label":'Permalink to "将husky安装命令配置为自动执行"'},"​")],-1),s("p",null,"在package.json的scripts中添加以下内容：",-1),s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,'"prepare": "husky install",')])])]),s("button",{class:"collapse"})],-1),s("p",null,"注意脚本名必须是prepare，这样使用npm、pnpm执行install命令时，这条命令会在安装完成时自动执行。",-1),s("p",null,"当代码上传到远程，同步到另一台设备时，安装完依赖就可以自动启用husky了，无需关心上面那些复杂动作。",-1),s("p",null,"但是我遇到了这样的问题：",-1),s("p",null,"所有配置都完全一致，执行husky安装命令提示安装成功，没有错误信息，但githook就是不触发。",-1),s("p",null,[i("原因是hook文件的权限不足。在windows上创建的文件提交并同步到mac上就会出现此类问题，因为不是使用"),s("code",null,"husky add"),i("命令创建的。")],-1),s("p",null,"解决方式很简单，只要执行以下命令即可：",-1),s("div",{class:"language-sh vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"sh"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"chmod"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," +x"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," .husky/pre-commit")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"chmod"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," +x"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," .husky/commit-msg")])])]),s("button",{class:"collapse"})],-1),s("p",null,"官网参考：",-1),s("p",null,[s("a",{href:"https://typicode.github.io/husky/#/?id=hooks-not-running",target:"_blank",rel:"noreferrer"},"https://typicode.github.io/husky/#/?id=hooks-not-running")],-1)])),"main-header":t(()=>[e(a.$slots,"main-header")]),"main-header-after":t(()=>[e(a.$slots,"main-header-after")]),"main-nav":t(()=>[e(a.$slots,"main-nav")]),"main-content":t(()=>[e(a.$slots,"main-content")]),"main-content-after":t(()=>[e(a.$slots,"main-content-after")]),"main-nav-before":t(()=>[e(a.$slots,"main-nav-before")]),"main-nav-after":t(()=>[e(a.$slots,"main-nav-after")]),comment:t(()=>[e(a.$slots,"comment")]),footer:t(()=>[e(a.$slots,"footer")]),aside:t(()=>[e(a.$slots,"aside")]),"aside-custom":t(()=>[e(a.$slots,"aside-custom")]),default:t(()=>[e(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{$ as default};
