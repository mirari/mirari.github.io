import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BWN6FZjJ.js";import{f as d,w as a,e as o,A as y,ag as p,o as m,a as s,H as i,U as e}from"./app-O6veFoRw.js";import"./YunComment.vue_vue_type_style_index_0_lang-BdmCVZ97.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-6OskRlK9.js";import"./post-CxZOEfth.js";const v={__name:"2020-07-22-mybatisplus_paging_multi-table_association_query",setup(c,{expose:r}){const l=JSON.parse('{"title":"MyBatisPlus分页多表关联查询","description":"","frontmatter":{"title":"MyBatisPlus分页多表关联查询","categories":["学习笔记"],"tags":["Java","MyBatis","Sql"],"date":"2020-07-22 18:33:00"},"headers":[],"relativePath":"pages/posts/2020-07-22-mybatisplus_paging_multi-table_association_query.md","path":"/home/runner/work/blog/blog/pages/posts/2020-07-22-mybatisplus_paging_multi-table_association_query.md","lastUpdated":1733198069000}'),n=y(),h=l.frontmatter||{};return n.meta.frontmatter=Object.assign(n.meta.frontmatter||{},l.frontmatter||{}),p("pageData",l),p("valaxy:frontmatter",h),globalThis.$frontmatter=h,r({frontmatter:{title:"MyBatisPlus分页多表关联查询",categories:["学习笔记"],tags:["Java","MyBatis","Sql"],date:"2020-07-22 18:33:00"}}),(t,k)=>{const E=g;return m(),d(E,{frontmatter:o(h)},{"main-content-md":a(()=>k[0]||(k[0]=[s("p",null,[s("code",null,"BaseMapper"),i("提供的默认查询方法都是单表的，如果需要多表关联查询，同时还要支持分页，一个方案就是自己写Sql。")],-1),s("p",null,"现在自己写Sql一般用的应该不是传统MyBatis那种写xml的老方法，而是通过在Mapper类里写注解来实现。",-1),s("p",null,"还需要解决的就是如何在自定义Sql语句中拼接MyBatisPlus的分页参数和查询条件。",-1),s("p",null,"示例如下：",-1),s("div",{class:"language-java vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," interface"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," GameQueryMapper"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," BaseMapper"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"GameQuery"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String querySql "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "SELECT a.*, b.org_id FROM t_game AS a LEFT JOIN t_game_game_org AS b ON b.game_id = a.id "'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String wrapperSql "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "SELECT * from ( "'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," querySql "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' " ) AS q ${ew.customSqlSegment}"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 分页查询")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Select"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(wrapperSql)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Page<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"GameQuery"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"page"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Page "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"page"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", @"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Param"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ew"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") Wrapper "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"queryWrapper"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 普通查询")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Select"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(wrapperSql)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    List<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"GameQuery"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"list"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Param"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ew"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") Wrapper "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"queryWrapper"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 单独查询")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Select"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(wrapperSql)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    QyyOrgQuery "),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"one"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Param"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ew"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") Wrapper "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"queryWrapper"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"collapse"})],-1),s("p",null,[i("关键在于Sql字符串最后那一句"),s("code",null,"${ew.customSqlSegment}"),i("，是用来拼接LambdaQueryWrapper等查询条件包裹器对象最终输出的Sql语句的。")],-1),s("p",null,"前面不能有WHERE，所以我在最外面又包了一层，将纯粹的多表关联查询语句与特殊组装语句区分开，这样不但可以在自定义Sql内部使用WHERE语句，也便于复制和创建新的Mapper。",-1),s("p",null,"但这里还要注意一个关键问题。",-1),s("p",null,"在Mapper里面自定义Sql注解对应的方法，其返回的Pojo对象，以及Mapper类指定的Pojo对象，他们必须完全一致。",-1),s("p",null,[i("即："),s("code",null,"extends BaseMapper<T>"),i(" 中的T需要与"),s("code",null,"Page<T>"),i("一致")],-1),s("p",null,[i("如果我在"),s("code",null,"public interface GameMapper extends BaseMapper<Game>"),i("里写了这样一个方法：")],-1),s("div",{class:"language-java vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Page"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"GameQuery"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," page"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Page page, @"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Param"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ew"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") Wrapper queryWrapper);")])])]),s("button",{class:"collapse"})],-1),s("p",null,[i("即使"),s("code",null,"GameQuery"),i("这个对应多表关联字段的Pojo继承自"),s("code",null,"Game"),i(",也会出现如下错误：")],-1),s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"evaluating expression 'ew.customSqlSegment'. Cause: org.apache.ibatis.ognl.OgnlException: customSqlSegment [com.baomidou.mybatisplus.core.exceptions.MybatisPlusException: can not find lambda cache for this entity")])])]),s("button",{class:"collapse"})],-1),s("p",null,"因此，多表关联分页查询的Mapper需要单独新建，与单表实例分开。",-1)])),"main-header":a(()=>[e(t.$slots,"main-header")]),"main-header-after":a(()=>[e(t.$slots,"main-header-after")]),"main-nav":a(()=>[e(t.$slots,"main-nav")]),"main-content":a(()=>[e(t.$slots,"main-content")]),"main-content-after":a(()=>[e(t.$slots,"main-content-after")]),"main-nav-before":a(()=>[e(t.$slots,"main-nav-before")]),"main-nav-after":a(()=>[e(t.$slots,"main-nav-after")]),comment:a(()=>[e(t.$slots,"comment")]),footer:a(()=>[e(t.$slots,"footer")]),aside:a(()=>[e(t.$slots,"aside")]),"aside-custom":a(()=>[e(t.$slots,"aside-custom")]),default:a(()=>[e(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{v as default};
